#一覧画面
class ReceiptListView(ListView):
    template_name = 'receipt/home.html'
    model = Receipt 

    # 賞味・消費期限通知機能
    def news_expiration_date(self):
        msg_list = []
        five_days = datetime.timedelta(days=5)
        zero_days = datetime.timedelta(days=0)
        today = datetime.date.today()
        items = Item.objects.all()
        for item in items:
            name = item.product_name
            day = item.expiration_date
            if day is not None:
                delta = day - today
                print(delta)
                if (delta <= five_days):
                   msg = f"{name}の賞味期限は残り{delta.days}日です"
                   msg_list.append(msg)
        
        return msg_list
    
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['msg_list'] = self.news_expiration_date()
        return context